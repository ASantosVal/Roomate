{% extends 'web/es/base.html' %}
{% load staticfiles %}
{% load bootstrap3 %}

{% block title %}Editar perfil{% endblock %}

{% block contenido %}

    <link href="{% static 'css/dropzone.css' %}" type="text/css" rel="stylesheet"/>

    <script src="{% static 'js/dropzone.js' %}"></script>
    <script type="text/javascript">
        Dropzone.options.myDropzone = {
            url:"#",
            // Prevents Dropzone from uploading dropped files immediately
            autoProcessQueue: false,
            addRemoveLinks: true,
            //probably with this it was easier to recover files
            paramName: "file",
            acceptedFiles: "image/*",
            maxFilesize: 5.0,
            maxFiles: 2,
            parallelUploads: 10000,
            uploadMultiple: true,

            init : function() {
                myDropzone=this;
                // You might want to show the submit button only when
                // files are dropped here:
                this.on("addedfile", function(file) {
                    if (document.querySelectorAll(".btremove").length>0){
                    var sub = document.querySelector(".btremove");
                    sub.parentNode.removeChild(sub);
                    var textright = document.querySelector(".text-right");
                    var cancel = document.querySelector(".btn-default");
                    var element = document.createElement("button");
                    element.className = "btn btn-primary";
                    element.type = "button";

                        var data = document.createTextNode("Guardar cambios");
                        element.appendChild(data);
                        textright.insertBefore(element, textright.firstChild);
                        submitButton = element;

                        submitButton.addEventListener("click", function () {
                            var files = myDropzone.getAcceptedFiles();
                            myDropzone.processFiles(files);
                            var filesqueue=myDropzone.getQueuedFiles();
                            for(var file in filesqueue){
                                myDropzone.processFile(file);
                            }
                            //myDropzone.processQueue();
                            document.getElementById("myDropzone").submit();
                            // Tell Dropzone to process all queued files.
                        });
                    }
                });

            }
        };
    </script>

    <a name="contenido"></a>
    <div class="content-section-a">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <form method="POST" class="edit-profile-form container dropzone" id="myDropzone" enctype="multipart/form-data" >

                        {% csrf_token %}
                        <h3>Edita tu perfil</h3>
                        <hr>

                        {% bootstrap_form form layout='horizontal' %} <!-- formulario del perfil -->

                        {% for tag in tag_forms %} <!-- iterar por todos los tags asociados a este usuario -->
                            <div class="container-fluid">
                                <div class="col-md-10">
                                    {% bootstrap_form tag class="form-control" placeholder=".col-xs-3" %}
                                    <!-- cada tag se muestra aqui -->
                                </div>
                                <div class="col-md-2">
                                    </br>
                                    <button>
                                        <a href="{% url 'delete_tag' texto_del_tag=tag.text.value %}"> Borrar este
                                            campo </a> <!-- boton para borrar este tag en concreto -->
                                    </button>
                                </div>
                            </div>
                        {% endfor %}

                        <div class='text-left'>
                            {% bootstrap_button "A&ntilde;adir un campo personalizado" button_type="link" href='/add_tag/' button_class="btn-info" %}
                            <!-- boton para anadir tag -->
                        </div>

                        </br>
                        </br>

                        <div class='text-right'>
                            {% bootstrap_button "Guardar cambios" button_type="submit" button_class="btn-primary btremove" %}
                            {% bootstrap_button "Cancelar" button_type="link" href="/" button_class="btn-danger" %}

                        </div>
                        <font size="3" color="red"> **(guarda los cambios antes de a&ntilde; o se borrar&aacute; lo que
                            has escrito)</font>  <!-- mensaje de alerta -->


                    </form>
                </div>
            </div>
        </div>
    </div>

{% endblock %}
